<!DOCTYPE html>
<html>
<head>
    <title>My Portfolio</title>
    <link rel="stylesheet" href="../main_style.css">
    <link rel="stylesheet" href="./proj2_style.css">
</head>
<body>
    <header>
        <h1 class="centered">Project 2</h1>
        <nav class="navbar">
            <a href="../index.html">Home</a>
            <a href="../index.html">Projects</a>
        </nav>
    </header>
    <main>
    <div class="description">
        <h3>Part 1: Fun with Filters</h3>

        <div class='subproblem'>
            <h4>Part 1.1: Convolutions from Scratch!</h4>
            <p>
                Naive approach with 4 for loops
                <pre><code>
def convovle_4(img, kernel,  mode='constant'):
    h,w = img.shape
    kernel = np.flip(kernel, (0, 1)) #flip the kernel
    k_h, k_w = kernel.shape
    convolved_img = np.copy(img)
    # padding
    pad_w= (k_w - 1) // 2
    pad_h = (k_h - 1) // 2
    img = np.pad(img, pad_width=((pad_h, pad_h), (pad_w, pad_w)), mode=mode)
    
    for i in range(w):
        for j in range(h):
            convolved_img[j][i] = 0
            for p in range(-pad_w, pad_w + 1):
                for q in range(-pad_h, pad_h + 1):
                    convolved_img[j][i] += kernel[q + pad_h][p + pad_w] * img[j + q + pad_h][i + p + pad_w]
    return convolved_img
                </code></pre>  
            </p>
            <p>
                Naive approach with 2 for loops
                <pre><code>
def patch(img, i, j, kw, kh):
    pad_w = (kw - 1) //2
    pad_h = (kh - 1) //2
    return img[j -pad_h:j+pad_h+1, i -pad_w:i+pad_w+1]
    
def convovle_2(img, kernel, mode='constant'):
    h,w = img.shape
    kernel = np.flip(kernel, (0, 1)) #flip the kernel
    k_h, k_w = kernel.shape
    convolved_img = np.copy(img)
    # zero padding
    pad_w= (k_w - 1) // 2
    pad_h = (k_h - 1) // 2

    img = np.pad(img, pad_width=((pad_h, pad_h), (pad_w, pad_w)), mode=mode)
    kernel_flat = kernel.ravel()
    for i in range(w):
        for j in range(h):
            curr_patch = patch(img, i+pad_w, j+pad_h, k_w, k_h)
            curr_patch_flat = curr_patch.ravel()
            convolved_img[j][i] = curr_patch_flat @ kernel_flat
    return convolved_img
                </code></pre>
            <p>
                The following is the code to construct kernels
            </p>
            <pre><code>
                box_filter_9 = 1/81 * np.ones((9,9))
                Dx = np.array([[1, 0, -1]])
                Dy = np.array([[1], [0], [-1]])
            </code></pre>
            </p>
            <p>
                The convolution with 4 for loops takes <b>18 seconds</b> to run.
            </p>

            <p>
                The convolution with 2 for loops takes <b>0.8 seconds</b> to run.
            </p>

            <p>
                The <code>scipy_convovle_img = signal.convolve2d(im, box_filter_9, mode='same')</code> 
                takes <b>0.1 seconds</b> to run.
            </p>

            <p>
                The less for loop we have in the implementation, the faster the convolution is.
            </p>

            <p>
                I used zero-padding to handle boundary. To apply kernel the pixels on the boundary, 
                I manually add <code>(kernel_width - 1) // 2</code> pixels with zero values on left and right side, and 
                <code>(kernel_height - 1) // 2</code> zero-value pixels for top and bottom.
            </p>
        </div>
        <div class="grid_2">
            <figure>
                <img src="./q1/selfie.jpg" alt="selfie" class="q1_image">
                <figcaption>original image</figcaption>
            </figure>
            <figure>
                <img src="./q1/convolve_4_blur.jpg" alt="selfie" class="q1_image">
                <figcaption>blurred image</figcaption>
            </figure>
            <figure>
                <img src="./q1/img_dx.jpg" alt="selfie" class="q1_image">
                <figcaption>image convolve with dx kernel</figcaption>
            </figure>
            <figure>
                <img src="./q1/img_dy.jpg" alt="selfie" class="q1_image">
                <figcaption>image convolve with dy kernel</figcaption>
            </figure>
        </div>
        <div class='subproblem'>
            <h4>Part 1.2: Finite Difference Operator</h4>
            <div class="grid_2">
                <figure>
                    <img src="./q1/cameraman.png" alt="selfie" class="q1_image">
                    <figcaption>Original Images</figcaption>
                </figure>
                <figure>
                    <img src="./q1/cameraman_dx.jpg" alt="selfie" class="q1_image">
                    <figcaption>With Dx kernel</figcaption>
                </figure>
                <figure>
                    <img src="./q1/cameraman_dy.jpg" alt="selfie" class="q1_image">
                    <figcaption>With Dy kernel</figcaption>
                </figure>
                <figure>
                    <img src="./q1/cameraman_grad_magnitude.jpg" alt="selfie" class="q1_image">
                    <figcaption>gradient Magnitude</figcaption>
                </figure>
                <figure>
                    <img src="./q1/binary_edges.jpg" alt="selfie" class="q1_image">
                    <figcaption>Binary Edges</figcaption>
                </figure>
            </div>
        <p>
            For binary edge image, to remove most of noise in the background, I chose threshold = 0.3. 
            This will make image lost most edges in the buildings in the background and weaker edge on cameraman.
            But this threshold can remove most noise in the sky and land.
        </p>
        </div>
        <div class='subproblem'>
            <h4>Part 1.3: Derivative of Gaussian (DoG) Filter</h4>
            <p>
                One way to create DoG filter: Convolve the gaussian kernel with D_x and D_y
            </p>
            <div class="grid_2">
                <figure>
                    <img src="./q1/binary_edges.jpg" alt="selfie" class="q1_image">
                    <figcaption>Binary Edges, threshold: 0.3</figcaption>
                </figure>
                <figure>
                    <img src="./q1/gaussian_binary_edges.jpg" alt="selfie" class="q1_image">
                    <figcaption>Gaussian then taking Dx Dy and Binary Edges, threshold: 0.21</figcaption>
                </figure>
                <figure>
                    <img src="./q1/DoG_binary_edges.jpg" alt="selfie" class="q1_image">
                    <figcaption>DoG Filter then Binary Edges, threshold: 0.21</figcaption>
                </figure>
            </div>
            <p>From above images, we can see using DoG filter we can remove most of noise in the background and preserve the main edges of cameraman
                DoG filter and blur image then apply Dx Dy on the blurred image can create same image
            </p>
        </div>
    </div>
    <div class="description">
        <div class='subproblem'>
            <h4>Part 2.1: Image "Sharpening"</h4>
            <div class="description">
                <p>
                    implemenet the gaussian kernel which is unsharp mask kernel, 
                    then convolve image with the kernel gave us the unsharp mask filter function
                    <pre><code> 
                        g1d = cv2.getGaussianKernel(3,1)
                        g2d = np.outer(g1d, g1d)
                        def blur_image_color(img, kernel):
                            img_channels = []
                            for i in range(3):
                                img_c = img[:,:,i]
                                sharpened_img_c = signal.convolve2d(img_c, kernel, mode='same')
                                img_channels.append(sharpened_img_c)
                            img = np.dstack(img_channels)
                            return img
                        blur_image_color(img, g2d)
                    </code></pre>
                </p>
                <p>
                    To sharpen the image, you will need apply unsharp mask filter(gaussian filter) to create an image with low frequency and 
                    get high frequency image by subtracting low frequency image from original image.
                    Then you add high frequency image back to original image to increase the intensity of the edge of high frequency and create sharpening effect.
                </p>
                <figure>
                    <img src="./q2/sharpen_formula.png" alt="q2" class="q2_image">
                    <figcaption>Formula to sharpen image in one convolution</figcaption>
                </figure>
                <p>
                    using the formula above, we can finish sharpening in one convolution and can change sharpen intensity by changing alpha
                    The higher the alpha value is,the stronger the sharpening effect is.
                </p>
            </div>
            <div class="grid_3">
                <figure>
                    <img src="./q2/taj.jpg" alt="q2" class="q2_image">
                    <figcaption>Original taj image</figcaption>
                </figure>
                <figure>
                    <img src="./q2/taj_high_freq.jpg" alt="selfie" class="q2_image">
                    <figcaption>Sharpen taj high frequency image</figcaption>
                </figure>
                <figure>
                    <img src="./q2/taj_sharp.jpg" alt="selfie" class="q2_image">
                    <figcaption>Sharpen taj image, alpha=2</figcaption>
                </figure>
                <figure>
                    <img src="./q2/taj_sharp_alpha7.jpg" alt="selfie" class="q2_image">
                    <figcaption>Sharpen taj image, alpha=7</figcaption>
                </figure>
                <figure>
                    <img src="./q2/house.jpg" alt="selfie" class="q2_image">
                    <figcaption>House image</figcaption>
                </figure>
                <figure>
                    <img src="./q2/house_high_freq.jpg" alt="selfie" class="q2_image">
                    <figcaption>House image high frequency</figcaption>
                </figure>
                <figure>
                    <img src="./q2/house_sharp_alpha2.jpg" alt="selfie" class="q2_image">
                    <figcaption>Sharpen House image, alpha=2</figcaption>
                </figure>
                <figure>
                    <img src="./q2/house_sharp.jpg" alt="selfie" class="q2_image">
                    <figcaption>Sharpen House image, alpha=6</figcaption>
                </figure>
                <figure>
                    <img src="./q2/campus.jpg" alt="selfie" class="q2_image">
                    <figcaption>Original Campus image</figcaption>
                </figure>
                <figure>
                    <img src="./q2/campus_blur.jpg" alt="selfie" class="q2_image">
                    <figcaption>blur campus image</figcaption>
                </figure>
                <figure>
                    <img src="./q2/campus_resharp_alpha2.jpg" alt="selfie" class="q2_image">
                    <figcaption>resharp campus image, alpha=2</figcaption>
                </figure>
                <figure>
                    <img src="./q2/campus_resharp.jpg" alt="selfie" class="q2_image">
                    <figcaption>resharp campus image, alpha=7</figcaption>
                </figure>
            </div>
        </div>
        <div class='subproblem'>
            <h4>Part 2.2: Hybrid Images</h4>
            This part, I will go through the step to create hybrid image using following two image professor Derek and cat nutmeg
             <div class="grid_2">
                <figure>
                    <img src="./hybrid_image/DerekPicture.jpg" alt="q2" class="q2_image">
                    <figcaption>Professor</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/prof_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>professor image frequency</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/nutmeg.jpg" alt="q2" class="q2_image">
                    <figcaption>Cat</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/cat_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>original cat image frequency</figcaption>
                </figure>
             </div>
            <div class="description">
                <h5>Step 1: aligned the image</h5>
                <p>We will first need to align the image so two image can overlap well in hybrid image
                    Here we will rotate nutmeg.jpg so the cat face and professor's face can align. 
                    I also adjust the sizes of two images.
                </p>
            </div>
            <div class="grid_2">
                <figure>
                    <img src="./hybrid_image/nutmeg_aligned.jpg" alt="q2" class="q2_image">
                    <figcaption>aligned cat image</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/cat_aligned_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>aligned cat image frequency</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/professor_aligned.jpg" alt="q2" class="q2_image">
                    <figcaption>aligned professor image</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/prof_aligned_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>aligned professor image frequency</figcaption>
                </figure>
            </div>
            <div class="description">
                <h5>Step 2: Filter Image</h5>
                <p>For image we want to see in close up, we will need to extract the high frequency of that image. 
                To do that, we apply high-pass filter on one image. Here we will apply high-pass filter on the nutmeg.jpg.
                Then we apply low-pass filter on the other image. 
                </p>
                <p>
                    low-pass filter can use gaussian filter
                </p>
                <p>
                    high-pass filter computed by subtracting the Gaussian-filtered image from the original.
                </p>
            </div>
            <div class="grid_2">
                <figure>
                    <img src="./hybrid_image/sample_highpass.jpg" alt="q2" class="q2_image">
                    <figcaption>high-pass image</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/sample_lowpass.jpg" alt="q2" class="q2_image">
                    <figcaption>low-pass image</figcaption>
                </figure>
                 <figure>
                    <img src="./hybrid_image/sample_highpass_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>high-pass freq</figcaption>
                </figure>
                <figure>
                    <img src="./hybrid_image/smaple_lowpass_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>low-pass freq</figcaption>
                </figure>
            </div>
            <div class="description">
                <h5>Step 3: Merge two image</h5>
                <p>
                    Finally we will add low-pass filtered image to high-pass filtered image to create hybrid image.
                    Here I use sigma1 = 80, sigma2 = 30 for image 1 and image 2 respectively.
                    From the fourier frequency image, we can see we merge the high-low freuqency from two images.
                </p>
            </div>
            <div class="grid_2">
                <figure>
                    <img src="./hybrid_image/professor_cat_hybrid.jpg" alt="q2" class="q2_image">
                    <figcaption>Hybrid_image parameter: sigma1 = 80, sigma2 = 30</figcaption>
                </figure>
            
                <figure>
                    <img src="./hybrid_image/sample_hybrid_freq.jpg" alt="q2" class="q2_image">
                    <figcaption>hybrid freq</figcaption>
                </figure>
            </div>
        <div class="description">
            <h5>Other hybrid image examples</h5>
        </div>
        <div class="grid_hybrid">
            <figure>
                    <img src="./hybrid_image/fish.jpeg" alt="q2" class="q2_image">
                    <figcaption>fish</figcaption>
            </figure>
            <figure>
                <img src="./hybrid_image/submarine.jpeg" alt="q2" class="q2_image">
                <figcaption>submarine</figcaption>
            </figure>
            <figure>
                <img src="./hybrid_image/fish_submarine_hybrid.jpg" alt="q2" class="q2_image">
                <figcaption>hybrid</figcaption>
            </figure>
            <figure>
                <img src="./hybrid_image/alonso.jpg" alt="q2" class="q2_image">
                <figcaption>fish</figcaption>
            </figure>
            <figure>
                <img src="./hybrid_image/max.jpg" alt="q2" class="q2_image">
                <figcaption>fish</figcaption>
            </figure>
            <figure>
                <img src="./hybrid_image/f1.jpg" alt="q2" class="q2_image">
                <figcaption>fish</figcaption>
            </figure>
        </div>
        </div>
        <div class='subproblem'>
            <h4>2.3: Gaussian and Laplacian Stacks</h4>
            <h5>Gaussian Stack for apple (sigma=100, ksize=15)</h5>
            <div class="stack">
                <figure>
                    <img src="./q2.4/apple.jpeg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_gaussian_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_gaussian_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_gaussian_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_gaussian_4.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_gaussian_5.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <h5>Gaussian Stack for orange (sigma=100, ksize=15)</h5>
            <div class="stack">
                <figure>
                    <img src="./q2.4/orange.jpeg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_gaussian_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_gaussian_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_gaussian_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_gaussian_4.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_gaussian_5.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <h5>Laplacian Stack for apple</h5>
            <div class="stack">
                <figure>
                    <img src="./q2.3/apple_laplacian_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_laplacian_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_laplacian_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apple_laplacian_4.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <h5>Laplacian Stack for orange</h5>
            <div class="stack">
                <figure>
                    <img src="./q2.3/orange_laplacian_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_laplacian_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_laplacian_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_laplacian_4.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <div class="description">
                <p>
                    Now we can apply build gaussian stack for the mask.
                    Then we apply each level's blurred mask to corresponding level of Laplacian stack of apple and orange
                </p>
            </div>
            <div class="grid_4">
                <figure>
                    <img src="./q2.3/apole_mask_0.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_mask_0.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_0.jpg" alt="q2" class="q2_image">
                </figure>
                 <figure>
                    <img src="./q2.3/apole_mask_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_mask_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_1.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apole_mask_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_mask_2.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_2.jpg" alt="q2" class="q2_image">
                </figure>
                 <figure>
                    <img src="./q2.3/apole_mask_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_mask_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_3.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/apole_mask_4.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/orange_mask_4.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_4.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
        </div>
        <div class='subproblem'>
            <h4>Part 2.4: Multiresolution Blending</h4>
            <div class="grid_2">
                <figure>
                    <img src="./q2.4/apple.jpeg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.4/orange.jpeg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.3/Oraple_final.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <div class="grid_2">
                <figure>
                    <img src="./q2.4/old_banana.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.4/fresh_banana.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.4/merge_banana.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
            <div class="grid_2">
                <figure>
                    <img src="./q2.4/hand.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.4/eye.jpg" alt="q2" class="q2_image">
                </figure>
                <figure>
                    <img src="./q2.4/hand_eye.jpg" alt="q2" class="q2_image">
                </figure>
            </div>
        </div>
    </div>
    </main>
    <footer class="footnote">
        <div>© 2025 Jim Jiang</div>
    </footer>
</body>